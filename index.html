<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>6MWT Pro</title>
    <style>
        /* --- COLOR VARIABLES --- */
        :root {
            /* Light Mode (Default) */
            --primary: #4f46e5;
            --primary-text: white;
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --border: #e5e7eb;
            --input-bg: #ffffff;
            --shadow: rgba(0,0,0,0.05);

            /* HR Colors (Light) */
            --hr-low-bg: #ecfdf5; --hr-low-text: #065f46; --hr-low-border: #d1fae5;
            --hr-mod-bg: #eff6ff; --hr-mod-text: #1e40af; --hr-mod-border: #dbeafe;
            --hr-high-bg: #fff7ed; --hr-high-text: #9a3412; --hr-high-border: #ffedd5;
        }

        /* Dark Mode Overrides */
        body.dark-mode {
            --primary: #6366f1; /* Slightly lighter indigo for contrast */
            --primary-text: #ffffff;
            --bg: #111827;      /* Very Dark Grey */
            --card-bg: #1f2937; /* Dark Grey Card */
            --text-main: #f3f4f6;
            --text-sub: #9ca3af;
            --border: #374151;
            --input-bg: #374151;
            --shadow: rgba(0,0,0,0.3);

            /* HR Colors (Dark) */
            /* Using darker backgrounds with bright text for readability */
            --hr-low-bg: #064e3b; --hr-low-text: #a7f3d0; --hr-low-border: #065f46;
            --hr-mod-bg: #1e3a8a; --hr-mod-text: #bfdbfe; --hr-mod-border: #1e40af;
            --hr-high-bg: #7c2d12; --hr-high-text: #fed7aa; --hr-high-border: #9a3412;
        }

        /* --- BASE STYLES --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            font-size: 16px;
            padding-bottom: 80px;
            transition: background-color 0.3s, color 0.3s; /* Smooth Transition */
        }

        .container { max-width: 600px; margin: 0 auto; position: relative; }

        /* HEADER & TOGGLE */
        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        h2 { font-size: 1.2rem; font-weight: 700; margin: 0; color: var(--text-main); }

        .theme-toggle {
            background: var(--card-bg);
            border: 1px solid var(--border);
            color: var(--text-main);
            width: 40px; height: 40px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 2px 5px var(--shadow);
            transition: transform 0.2s;
        }
        .theme-toggle:active { transform: scale(0.9); }

        /* CARDS */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 4px var(--shadow);
            border: 1px solid var(--border);
            transition: background-color 0.3s, border-color 0.3s;
        }

        .card-title {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
            color: var(--text-main);
        }

        /* INPUT GRID */
        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .input-group { display: flex; flex-direction: column; }
        .input-group:last-child { grid-column: span 2; }

        label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 700;
            color: var(--text-sub);
            margin-bottom: 5px;
        }

        input, select {
            appearance: none;
            background: var(--input-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            font-size: 1rem;
            color: var(--text-main);
            width: 100%;
            transition: border 0.2s, background 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
        }

        @media (min-width: 600px) {
            .input-grid { grid-template-columns: repeat(5, 1fr); }
            .input-group:last-child { grid-column: span 1; }
        }

        /* BUTTONS */
        .btn-group {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 14px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }

        .btn-primary { background: var(--primary); color: var(--primary-text); }
        .btn-secondary { background: var(--input-bg); border: 1px solid var(--border); color: var(--text-sub); width: 50px; }
        .btn:active { transform: scale(0.98); }

        /* SETTINGS DRAWER */
        .drawer {
            display: none;
            background: var(--bg);
            padding: 15px;
            margin-top: 10px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        .drawer.open { display: block; }
        .setting-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .setting-row input { width: 70px; text-align: center; }

        /* RESULTS */
        #report { display: none; }

        .hr-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        
        .hr-card {
            padding: 10px 4px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid transparent;
        }
        .hr-card label { display: block; font-size: 0.65rem; margin-bottom: 2px; opacity: 0.9; font-weight: bold; }
        .hr-card .val { font-size: 1.1rem; font-weight: 800; display: block; }
        .hr-card .sub { font-size: 0.65rem; opacity: 0.8; }

        /* Dynamic HR Colors via classes */
        .hr-low { background-color: var(--hr-low-bg); color: var(--hr-low-text); border-color: var(--hr-low-border); }
        .hr-mod { background-color: var(--hr-mod-bg); color: var(--hr-mod-text); border-color: var(--hr-mod-border); }
        .hr-high { background-color: var(--hr-high-bg); color: var(--hr-high-text); border-color: var(--hr-high-border); }

        #fullAnalysisCard { display: none; }

        .stats-container { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .stat-box {
            flex: 1 1 30%;
            background: var(--bg);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            min-width: 80px;
            border: 1px solid var(--border);
        }
        .stat-val { font-size: 1.25rem; font-weight: 800; color: var(--primary); }
        .stat-lbl { font-size: 0.7rem; color: var(--text-sub); margin-top: 4px; line-height: 1.2; }

        .rx-item {
            display: flex; align-items: center; padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }
        .rx-item:last-child { border-bottom: none; }
        
        .rx-icon { 
            width: 40px; height: 40px; 
            background: var(--bg); color: var(--primary);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            margin-right: 12px; flex-shrink: 0; font-size: 1.2rem;
            border: 1px solid var(--border);
        }
        
        .rx-content { flex: 1; }
        .rx-title { font-weight: 600; font-size: 0.95rem; color: var(--text-main); }
        .rx-desc { font-size: 0.8rem; color: var(--text-sub); }
        .rx-result { font-weight: 700; color: var(--text-main); font-size: 1rem; text-align: right; margin-left: 10px; white-space: nowrap;}

        .formula-tab {
            margin-top: 20px;
            background: #111827; /* Always dark for code look */
            color: #d1d5db;
            padding: 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: none;
        }
        .formula-tab.open { display: block; }
        .formula-line { margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #374151; }
        .formula-line strong { color: #60a5fa; display: block; margin-bottom: 4px; }
        
        .toggle-link {
            display: block; text-align: center; margin-top: 20px;
            color: var(--text-sub); font-size: 0.85rem; text-decoration: underline; cursor: pointer;
        }
        
        .missing-info-msg {
            text-align: center; font-size: 0.8rem; color: var(--text-sub); padding-top: 10px; font-style: italic;
        }
    </style>
</head>
<body>

<div class="container">
    
    <div class="header-row">
        <h2>6MWT Input</h2>
        <button class="theme-toggle" onclick="toggleTheme()" id="themeIcon">‚òæ</button>
    </div>

    <!-- INPUT CARD -->
    <div class="card">
        <div class="input-grid">
            <div class="input-group">
                <label>Gender</label>
                <select id="gender">
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                </select>
            </div>
            <div class="input-group">
                <label>Age</label>
                <input type="number" id="age" placeholder="Yrs" inputmode="decimal">
            </div>
            <div class="input-group">
                <label>Height (cm)</label>
                <input type="number" id="height" placeholder="cm" inputmode="decimal">
            </div>
            <div class="input-group">
                <label>Weight (kg)</label>
                <input type="number" id="weight" placeholder="kg" inputmode="decimal">
            </div>
            <div class="input-group">
                <label>Distance Walked</label>
                <input type="number" id="distance" placeholder="Meters" inputmode="decimal">
            </div>
        </div>

        <!-- Hidden Settings -->
        <div id="settingsDrawer" class="drawer">
            <div class="setting-row">
                <label>Lower Intensity (%)</label>
                <input type="number" id="lowPct" value="80" inputmode="decimal">
            </div>
            <div class="setting-row">
                <label>Upper Intensity (%)</label>
                <input type="number" id="highPct" value="100" inputmode="decimal">
            </div>
        </div>

        <div class="btn-group">
            <button class="btn btn-secondary" onclick="toggleSettings()" aria-label="Settings">‚öôÔ∏è</button>
            <button class="btn btn-primary" onclick="calculate()">Generate Report</button>
        </div>
    </div>

    <!-- REPORT CARD -->
    <div id="report">
        
        <!-- Heart Rate (Always shows if Age exists) -->
        <div class="card">
            <div class="card-title">Target Heart Rate</div>
            <div class="hr-grid">
                <div class="hr-card hr-low">
                    <label>LOW 60%</label>
                    <span class="val" id="hr60">--</span>
                    <span class="sub">RPE 10-11</span>
                </div>
                <div class="hr-card hr-mod">
                    <label>MOD 70%</label>
                    <span class="val" id="hr70">--</span>
                    <span class="sub">RPE 12-13</span>
                </div>
                <div class="hr-card hr-high">
                    <label>HIGH 80%</label>
                    <span class="val" id="hr80">--</span>
                    <span class="sub">RPE 14-15</span>
                </div>
            </div>
            <div id="partialMsg" class="missing-info-msg" style="display:none;">
                Enter Height, Weight & Distance to see full analysis.
            </div>
        </div>

        <!-- Analysis & Rx (Only shows if all data exists) -->
        <div class="card" id="fullAnalysisCard">
            <div class="card-title">Clinical Analysis</div>
            <div class="stats-container">
                <div class="stat-box">
                    <div class="stat-val" id="predVal">--</div>
                    <div class="stat-lbl">Predicted (m)</div>
                </div>
                <div class="stat-box">
                    <div class="stat-val" id="pctVal">--%</div>
                    <div class="stat-lbl">% Predicted</div>
                </div>
                <div class="stat-box" style="flex-basis: 100%;">
                    <div class="stat-val" id="llnVal">--</div>
                    <div class="stat-lbl">Lower Limit of Normal (LLN)</div>
                </div>
            </div>

            <div class="card-title">Prescription <span style="font-size:0.8rem; font-weight:400; color:var(--text-sub);"> (Range: <span id="usedRange"></span>)</span></div>
            
            <div class="rx-item">
                <div class="rx-icon">üö∂</div>
                <div class="rx-content">
                    <div class="rx-title">Walking 20m</div>
                    <div class="rx-desc">Daily distance</div>
                </div>
                <div class="rx-result" id="rxWalk20">--</div>
            </div>

            <div class="rx-item">
                <div class="rx-icon">üö∂</div>
                <div class="rx-content">
                    <div class="rx-title">Walking 30m</div>
                    <div class="rx-desc">Daily distance</div>
                </div>
                <div class="rx-result" id="rxWalk30">--</div>
            </div>

            <div class="rx-item">
                <div class="rx-icon">üèÉ</div>
                <div class="rx-content">
                    <div class="rx-title">Treadmill</div>
                    <div class="rx-desc">Speed (km/h)</div>
                </div>
                <div class="rx-result" id="rxTread">--</div>
            </div>
        </div>

        <!-- Formula Toggle -->
        <div class="toggle-link" onclick="toggleFormula()">Show Calculation Logic</div>

        <div id="formulaTab" class="formula-tab">
            <div class="formula-line">
                <strong>Target Heart Rate</strong>
                (220 - Age) √ó Intensity
            </div>
            <div class="formula-line">
                <strong>Pred Distance (Enright '98)</strong>
                M: (7.57√óH) - (5.02√óA) - (1.76√óW) - 309<br>
                F: (2.11√óH) - (2.29√óW) - (5.78√óA) + 667
            </div>
            <div class="formula-line">
                <strong>Rx Logic</strong>
                Base Speed = ActualDist / 100 (km/h)<br>
                Min = Base √ó Low% | Max = Base √ó High%<br>
                Walk 20 = Speed √ó 0.33h<br>
                Walk 30 = Speed √ó 0.50h
            </div>
        </div>

    </div>
</div>

<script>
    // --- THEME LOGIC ---
    function toggleTheme() {
        const body = document.body;
        const icon = document.getElementById('themeIcon');
        body.classList.toggle('dark-mode');
        
        if (body.classList.contains('dark-mode')) {
            icon.innerText = '‚òÄ';
            localStorage.setItem('theme', 'dark');
        } else {
            icon.innerText = '‚òæ';
            localStorage.setItem('theme', 'light');
        }
    }

    // Load saved theme on start
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
        document.getElementById('themeIcon').innerText = '‚òÄ';
    }

    // --- APP LOGIC ---
    function toggleSettings() {
        document.getElementById('settingsDrawer').classList.toggle('open');
    }

    function toggleFormula() {
        document.getElementById('formulaTab').classList.toggle('open');
        if(document.getElementById('formulaTab').classList.contains('open')){
            window.scrollTo(0, document.body.scrollHeight);
        }
    }

    function calculate() {
        // Data gathering
        const gender = document.getElementById('gender').value;
        const age = parseFloat(document.getElementById('age').value);
        const ht = parseFloat(document.getElementById('height').value);
        const wt = parseFloat(document.getElementById('weight').value);
        const dist = parseFloat(document.getElementById('distance').value);
        
        const lowPct = parseFloat(document.getElementById('lowPct').value) / 100;
        const highPct = parseFloat(document.getElementById('highPct').value) / 100;

        // 1. MINIMUM VALIDATION: Age is required
        if(!age) {
            alert("Please enter at least your AGE to generate Target Heart Rates.");
            return;
        }

        // 2. SHOW REPORT CONTAINER
        const report = document.getElementById('report');
        report.style.display = 'block';

        // 3. CALCULATE HEART RATE (Available with just Age)
        const maxHR = 220 - age;
        document.getElementById('hr60').innerText = Math.round(maxHR*0.6);
        document.getElementById('hr70').innerText = Math.round(maxHR*0.7);
        document.getElementById('hr80').innerText = Math.round(maxHR*0.8);

        // 4. CHECK IF FULL DATA IS AVAILABLE
        const fullDataAvailable = (ht && wt && dist);
        const fullCard = document.getElementById('fullAnalysisCard');
        const partialMsg = document.getElementById('partialMsg');

        if(fullDataAvailable) {
            // SHOW Full Analysis
            fullCard.style.display = 'block';
            partialMsg.style.display = 'none';

            // -- PREDICTION LOGIC --
            let pred = 0, lln = 0;
            if(gender === 'male') {
                pred = (7.57 * ht) - (5.02 * age) - (1.76 * wt) - 309;
                lln = pred - 153;
            } else {
                pred = (2.11 * ht) - (2.29 * wt) - (5.78 * age) + 667;
                lln = pred - 139;
            }

            document.getElementById('predVal').innerText = pred.toFixed(0);
            document.getElementById('pctVal').innerText = ((dist/pred)*100).toFixed(0) + "%";
            document.getElementById('llnVal').innerText = lln.toFixed(0);

            // -- RX LOGIC --
            const baseSpd = dist / 100;
            const minSpd = baseSpd * lowPct;
            const maxSpd = baseSpd * highPct;

            document.getElementById('rxTread').innerText = `${minSpd.toFixed(1)} - ${maxSpd.toFixed(1)}`;
            document.getElementById('rxWalk20').innerText = `${(minSpd/3).toFixed(1)} - ${(maxSpd/3).toFixed(1)} km`;
            document.getElementById('rxWalk30').innerText = `${(minSpd*0.5).toFixed(1)} - ${(maxSpd*0.5).toFixed(1)} km`;
            
            document.getElementById('usedRange').innerText = `${(lowPct*100).toFixed(0)}-${(highPct*100).toFixed(0)}%`;

        } else {
            // HIDE Full Analysis if data missing
            fullCard.style.display = 'none';
            partialMsg.style.display = 'block';
        }

        // Scroll to results
        report.scrollIntoView({ behavior: 'smooth' });
    }
</script>

</body>
</html>
